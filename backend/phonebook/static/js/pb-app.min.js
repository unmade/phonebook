!function(){"use strict";angular.module("pbApp",["ngRoute","ngResource","ngMaterial","infinite-scroll","pbApp.routes","pbApp.layout","pbApp.employees","pbApp.companies","pbApp.feedback","pbApp.utils"]),angular.module("pbApp.routes",[])}();
!function(){"use strict";angular.module("pbApp.companies",["ngResource"])}();
!function(){"use strict";angular.module("pbApp.employees",["ngResource","pbApp.layout"])}();
!function(){"use strict";angular.module("pbApp.feedback",["ngResource"])}();
!function(){"use strict";angular.module("pbApp.layout",[])}();
!function(){"use strict";angular.module("pbApp.utils",[])}();
!function(){"use strict";function e(e,r,t){e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFToken",r.defaults.stripTrailingSlashes=!1,t.theme("default").accentPalette("red")}angular.module("pbApp").config(e),e.$inject=["$httpProvider","$resourceProvider","$mdThemingProvider"]}();
!function(){"use strict";function e(e){e.when("/companies",{templateUrl:"/static/partials/companies/company-list.html",controller:"CompanyListCtrl",controllerAs:"ctrl"}).when("/employees",{templateUrl:"/static/partials/employees/employee-list.html",controller:"EmployeeListCtrl",controllerAs:"ctrl"}).when("/feedback",{templateUrl:"/static/partials/feedback/feedbacks.html",controller:"FeedbackListCtrl",controllerAs:"ctrl"}).otherwise({redirectTo:"/employees"})}angular.module("pbApp.routes").config(e),e.$inject=["$routeProvider"]}();
!function(){"use strict";function e(e){return e("api/companies/company/:id",{},{query:{method:"GET",isArray:!1}})}function r(e){return e("api/companies/center/:id",{},{query:{method:"GET",isArray:!1}})}function i(e){return e("api/companies/division/:id",{},{query:{method:"GET",isArray:!1}})}angular.module("pbApp.companies").factory("companyService",["$resource",e]).factory("centerService",["$resource",r]).factory("divisionService",["$resource",i]),e.$inject=["$resourse"],r.$inject=["$resourse"],i.$inject=["$resourse"]}();
!function(){"use strict";function e(){return{restrict:"AE",templateUrl:"company-detail.directive.html",scope:{company:"=company"}}}angular.module("pbApp.companies").directive("companyDetail",e)}();
!function(){"use strict";function e(e,n,o,i){function t(e){e&&(c.company=e,n("company-detail-right").toggle())}function r(n){var i=4;if(!n)return c.companies.results.slice(0,i);var t=e.defer();return o.query({search:n,limit:i,offset:0},function(e,n){t.resolve(e.results)}),t.promise}var c=this;c.companies=new i({limit:40,offset:0}),c.showCompanyDetail=t,c.companySearch=r}angular.module("pbApp.companies").controller("CompanyListCtrl",e),e.$inject=["$q","$mdSidenav","companyService","companyScroll"]}();
!function(){"use strict";function t(t){var s=function(t){this.results=[],this.after=void 0,this.params=angular.copy(t)||{},this.params.offset=t&&t.offset?t.offset:0,this.params.limit=t&&t.limit?t.limit:20,this.busy=!1};return s.prototype.nextPage=function(){this.busy||null!==this.after&&(this.busy=!0,t.query(this.params,function(t){this.results=this.results.concat(t.results),this.params.offset+=this.params.limit,this.after=t.next,this.busy=!1}.bind(this)))},s}angular.module("pbApp.companies").factory("companyScroll",t),t.$inject=["companyService"]}();
!function(){"use strict";function e(e,n,t,l,s,i,o,c){function r(e){e&&(h.employee=e,t("employee-detail-right").toggle())}function u(){h.selectedCenter=null,h.selectedDivision=null,h.employees=new s({company:h.selectedCompany,search:h.searchText||null}),h.employees.nextPage()}function a(){h.selectedDivision=null,h.employees=new s({company:h.selectedCompany,center:h.selectedCenter,search:h.searchText||null}),h.employees.nextPage()}function m(){h.employees=new s({company:h.selectedCompany,center:h.selectedCenter,division:h.selectedDivision,search:h.searchText||null}),h.employees.nextPage()}function p(t){var s=8;if(!t)return h.employees.results.slice(0,s);var i=e.defer(),o=n("englishCharsToRussian")(t);return l.query({search:o,limit:s,offset:0},function(e,n){i.resolve(e.results)}),i.promise}function d(e){var n=function(e){return e?e:""};return(n(e.surname)+" "+n(e.firstname)+" "+n(e.patronymic)).trim()}function y(){return h.companies||i.query(function(e){h.companies=e})}function v(){return h.centers&&h.centers.results.length&&h.centers.results[0].company==h.selectedCompany?void 0:o.query({company:h.selectedCompany},function(e){h.centers=e})}function f(){return h.divisions&&h.divisions.results.length&&h.divisions.results[0].center==h.selectedCenter?void 0:c.query({center:h.selectedCenter},function(e){h.divisions=e})}function C(e){h.selectedCompany=null,h.selectedCenter=null,h.selectedDivision=null,h.employees=new s({search:e}),h.employees.nextPage()}var h=this;h.employees=new s,h.companies=null,h.centers=null,h.divisions=null,h.selectedCompany=null,h.selectedCenter=null,h.selectedDivision=null,h.companyChanged=u,h.centerChanged=a,h.divisionChanged=m,h.employeeSearch=p,h.getEmployeeName=d,h.loadCompanies=y,h.loadCenters=v,h.loadDivisions=f,h.search=C,h.openSidenav=function(){t("left").toggle()},h.showEmployeeDetail=r}angular.module("pbApp.employees").controller("EmployeeListCtrl",e),e.$inject=["$q","$filter","$mdSidenav","employeeService","EmployeeScroll","companyService","centerService","divisionService"]}();
!function(){"use strict";function t(t){var s=function(t){this.results=[],this.after=void 0,this.params=angular.copy(t)||{},this.params.offset=t&&t.offset?t.offset:0,this.params.limit=t&&t.limit?t.limit:20,this.busy=!1};return s.prototype.nextPage=function(){this.busy||null!==this.after&&(this.busy=!0,t.query(this.params,function(t){this.results=this.results.concat(t.results),this.params.offset+=this.params.limit,this.after=t.next,this.busy=!1}.bind(this)))},s}angular.module("pbApp.employees").factory("EmployeeScroll",t),t.$inject=["employeeService"]}();
!function(){"use strict";function e(e){return e("api/employees/employee/:id",{},{query:{method:"GET",isArray:!1}})}angular.module("pbApp.employees").factory("employeeService",e),e.$inject=["$resource"]}();
!function(){"use strict";function e(){return function(e){switch(e){case"DF":return"";case"PR":return"В процессе";case"NW":return"Новое";case"SL":return"Выполнено";case"RJ":return"Не будет выполнено";default:return""}}}angular.module("pbApp.feedback").filter("getStatusName",e)}();
!function(){"use strict";function e(e){return e("api/feedback/feedback/",{},{query:{method:"GET",isArray:!1}})}angular.module("pbApp.feedback").factory("feedbackService",e),e.$inject=["$resource"]}();
!function(){"use strict";function e(e,t,i){function o(t){e.show({templateUrl:"new-feedback-dialog.tmpl.html",targetEvent:t,clickOutsideToClose:!0,controller:c,controllerAs:"dialog"})}function c(){function t(){e.hide(),i.query({limit:50,offset:0},function(e){l.feedbacks=e})}var o=this;o.hide=t}var l=this;l.feedbacks=i.query({limit:50,offset:0}),l.showNewFeedbackDialog=o}angular.module("pbApp.feedback").controller("FeedbackListCtrl",e),e.$inject=["$mdDialog","$mdToast","feedbackService"]}();
!function(){"use strict";function e(){return{bindToController:!0,controller:t,controllerAs:"newFeedback",replace:!0,restrict:"AE",scope:{onSend:"&"},templateUrl:"new-feedback.directive.html"}}function t(e,t,o,n){function s(){r.sender&&r.text&&n.save({sender:r.sender,text:r.text},function(e){r.status="",r.onSend&&r.onSend(),r.showSuccessToast()},function(e){r.status="Error",r.showFailedToast()})}function i(){o.show(o.simple().textContent("Ваше сообщение принято!").position("top right").hideDelay(3e3))}function c(){o.show(o.simple().textContent("Отправка не удалась!").position("top right").hideDelay(3e3))}var r=this;r.add=s,r.showSuccessToast=i,r.showFailedToast=c}angular.module("pbApp.feedback").directive("newFeedback",e),t.$inject=["$scope","$mdDialog","$mdToast","feedbackService"]}();
!function(){"use strict";function e(){return{controller:n,controllerAs:"menu",restrict:"AE",replace:!0,templateUrl:"menu.directive.html"}}function n(e){function n(){e("left-menu").close()}function t(){e("left-menu").toggle()}var c=this;c.pages=[{url:"employees",name:"Сотрудники",icon:"contact_phone"},{url:"companies",name:"Организации",icon:"business"},{url:"feedback",name:"Обратная связь",icon:"feedback"}],c.closeMenu=n,c.openMenu=t}angular.module("pbApp.layout").directive("mainMenu",e),e.$inject=[],n.$inject=["$mdSidenav"]}();
!function(){"use strict";function n(){return function(n){var u,r={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"х","]":"ъ","}":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"ж","'":"э",'"':"э","\\":"ё","`":"ё","|":"ё",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"б",".":"ю",">":"ю"},t=n.toLowerCase(),s=[];for(u=0;u<t.length;u+=1)r[t[u]]?s.push(r[t[u]]):s.push(t[u]);return s.join("")}}angular.module("pbApp.utils").filter("englishCharsToRussian",n)}();
!function(){"use strict";function e(){return function(e){function c(e){return 4==e.length?e.slice(0,2)+"-"+e.slice(2):7==e.length?e.slice(0,3)+"-"+e.slice(3,5)+"-"+e.slice(5,7):e}if(!e)return"";var i,r,t,s=e.toString().replace(/[()-\s]+/g,"");switch(s.length){case 4:case 7:return c(s);case 10:i="",r=s.slice(0,3),t=c(s.slice(3));break;case 11:i=s[0],r=s.slice(1,4),t=c(s.slice(4));break;case 12:i=s.slice(0,2),r=s.slice(2,5),t=c(s.slice(5));break;default:return e}return(i+" ("+r+") "+t).trim()}}angular.module("pbApp.utils").filter("formatPhone",e)}();
!function(){"use strict";function e(){return{restrict:"AE",templateUrl:"directives/employee-detail.directive.html",scope:{employee:"=employee"}}}angular.module("pbApp.employees").directive("employeeDetail",e)}();
!function(){"use strict";function e(){return{restrict:"AE",templateUrl:"directives/employee-list-item.directive.html",scope:{employee:"=employee"}}}angular.module("pbApp.employees").directive("employeeListItem",e)}();
angular.module("pbApp.companies").run(["$templateCache",function(n){n.put("company-detail.directive.html",'<md-content layout="column">\n    <div class="company-detail_logo">\n        <img ng-src="{{ company.logo }}" />\n    </div>\n\n    <div class="company-detail_name">\n        <h3 class="md-title">{{ company.name }}</h3>\n        <p class="md-caption" ng-if="company.ceo">Директор: {{ company.ceo }}</p>\n    </div>\n\n    <div class="md-whiteframe-4dp">\n        <md-list>\n            <md-list-item class="md-1-line" ng-show="company.address">\n                <md-icon>place</md-icon>\n                <p>{{ company.address }}</p>\n            </md-list-item>\n            <md-list-item class="md-2-line"\n                          ng-repeat="phone in company.phones">\n                <md-icon ng-if="$first">phone</md-icon>\n                <div class="md-list-item-text" ng-class="{\'md-offset\': !$first}">\n                    <h3>{{ phone.number }}</h3>\n                    <p>{{ phone.category }}</p>\n                </div>\n            </md-list-item>\n            <md-list-item class="md-2-line"\n                          ng-repeat="email in company.emails">\n                <md-icon ng-if="$first">email</md-icon>\n                <div class="md-list-item-text" ng-class="{\'md-offset\': !$first}">\n                    <h3>{{ email.email }}</h3>\n                    <p>{{ email.category }}</p>\n                </div>\n            </md-list-item>\n        </md-list>\n\n        <md-divider ng-show="company.full_name || company.comment"></md-divider>\n\n        <md-list>\n            <md-list-item class="md-1-line" ng-show="company.full_name">\n                <md-icon>description</md-icon>\n                <p>{{ company.full_name }}</p>\n            </md-list-item>\n\n            <md-list-item class="md-1-line" ng-show="company.comment">\n                <md-icon>info</md-icon>\n                <p>{{ company.comment }}</p>\n            </md-list-item>\n        </md-list>\n\n    </div>\n</md-content>\n')}]);
angular.module("pbApp.employees").run(["$templateCache",function(e){e.put("directives/employee-detail.directive.html",'<md-content layout="column">\n    <div layout="row" layout-align="center center" class="employee-detail_name" layout-padding>\n        <div layout="column" layout-align="start start" layout-padding>\n            <h3 class="md-headline">\n                {{ employee.surname }}\n                <span class="md-title">{{ employee.firstname }} {{ employee.patronymic }}</span>\n            </h3>\n            <p class="md-body-1">{{ employee.position }}</p>\n            <div>\n                <p class="md-caption">\n                    {{ employee.company.name }}\n                    <md-icon ng-show="employee.center.name" class="pb-text-pale-white">chevron_right</md-icon>\n\n                    {{ employee.center.number }}\n                    <span ng-show="employee.center.number && employee.center.name">&nbsp-&nbsp</span>\n                    {{ employee.center.name }}\n\n                    <md-icon ng-show="employee.division.name" class="pb-text-pale-white">chevron_right</md-icon>\n\n                    {{ employee.division.number }}\n                    <span ng-show="employee.division.number && employee.division.name">&nbsp-&nbsp</span>\n                    {{ employee.division.name }}\n                    &nbsp\n                </p>\n                <md-divider ng-if="employee.place"></md-divier>\n                <p>{{ employee.place }}</p>\n            </div>\n        </div>\n    </div>\n\n    <div layout-padding class="md-whiteframe-z2">\n        <md-list ng-if="employee.phones.length || employee.emails.length">\n            <md-list-item class="md-2-line" ng-repeat="phone in employee.phones">\n                <md-icon ng-if="$first">phone</md-icon>\n                <div class="md-list-item-text" ng-class="{\'md-offset\': !$first}">\n                    <h4 >{{ phone.number | formatPhone }}</h4>\n                    <p>{{ phone.category }}</p>\n                </div>\n            </md-list-item>\n            <md-list-item class="md-2-line" ng-repeat="email in employee.emails">\n                <md-icon ng-if="$first">email</md-icon>\n                <div class="md-list-item-text" ng-class="{\'md-offset\': !$first}">\n                    <h4 >{{ email.email }}</h4>\n                    <p>{{ email.category }}</p>\n                </div>\n            </md-list-item>\n        </md-list>\n\n        <md-divider ng-show="employee.birthday || employee.secretary.length || employee.comment"></md-divider>\n\n        <md-list>\n            <md-list-item class="md-1-line" ng-show="employee.birthday">\n                <md-icon class="pb-avatar-icon">cake</md-icon>\n                <p>{{ employee.birthday | date:\'dd.MM.yyyy\' }}</p>\n            </md-list-item>\n\n            <md-list-item class="md-1-line"\n                          ng-repeat="secretary in employee.secretary"\n                          ng-show="employee.secretary.length">\n                <md-icon>assistant</md-icon>\n                <p>\n                    {{ secretary.surname }}\n                    {{ secretary.firstname }}\n                    {{ secretary.patronymic }}\n                </p>\n            </md-list-item>\n\n            <md-list-item class="md-1-line" ng-show="employee.comment">\n                <md-icon>info</md-icon>\n                <p>{{ employee.comment }}</p>\n            </md-list-item>\n        </md-list>\n\n    </div>\n</md-content>\n'),e.put("directives/employee-list-item.directive.html",'<div layout="row" layout-padding layout-align="start center" class="employee-list-item">\n    <div flex="33">\n        <h4 class="md-subhead">{{ employee.surname }} {{ employee.firstname }} {{ employee.patronymic }}</h4>\n        <p class="md-caption pb-text-muted">{{ employee.position }}</p>\n    </div>\n    <div layout="row" class="employee-list-item_contacts" flex="35">\n        <md-list flex>\n            <md-list-item ng-repeat="phone in employee.phones" ng-show="$even">\n                <md-tooltip md-direction="left">{{ phone.category }}</md-tooltip>\n                <p>{{ phone.number | formatPhone }}</p>\n            </md-list-item>\n        </md-list>\n        <md-list flex>\n            <md-list-item ng-repeat="phone in employee.phones" ng-show="$odd">\n                <md-tooltip md-direction="left">{{ phone.category }}</md-tooltip>\n                <p>{{ phone.number | formatPhone }}</p>\n            </md-list-item>\n        </md-list>\n    </div>\n    <div class="employee-list-item_contacts">\n        <md-list>\n            <md-list-item ng-repeat="email in employee.emails">\n                <md-tooltip md-direction="left">{{ email.category }}</md-tooltip>\n                <p>{{ email.email }}</p>\n            </md-list-item>\n        </md-list>\n    </div>\n    <span flex></span>\n    <div class="employee-list-item_company" ng-show="employee.company">\n        <md-tooltip>\n            {{ employee.company.name }}\n        </md-tooltip>\n        <img ng-src="{{ employee.company.logo }}" alt="{{ employee.company.name }}" />\n        <p class="pb-text-muted">\n            {{ employee.center.number }}\n            <md-icon ng-show="employee.division">chevron_right</md-icon>\n            {{ employee.division.number }}\n        </p>\n    </div>\n</div>\n')}]);
angular.module("pbApp.feedback").run(["$templateCache",function(e){e.put("new-feedback.directive.html",'<form name="newFeedbackForm" layout="column" layout-padding style="min-width:640px;min-height:480px;">\n    <md-input-container class="md-block">\n        <label>Представьтесь</label>\n        <input ng-model="newFeedback.sender"\n               name="sender"\n               md-maxlength="50"\n               required\n               autofocus="true">\n        <div ng-messages="NewFeedbackForm.sender.$error">\n            <div ng-message="required">Необходимо указать <b>своё</b> ФИО.</div>\n            <div ng-message="md-maxlength">Убедитесь, что в этом поле не больше 50 символов</div>\n        </div>\n    </md-input-container>\n\n    <md-input-container class="md-block" flex>\n        <label>Текст</label>\n        <textarea ng-model="newFeedback.text"\n                  columns="1"\n                  md-maxlength="500"\n                  rows="6"\n                  name="text"\n                  required>\n        </textarea>\n        <div ng-messages="NewFeedbackForm.text.$error">\n            <div ng-message="required">Поле не может быть пустым!</div>\n            <div ng-message="md-maxlength">Убедитесь, что в этом поле не больше 500 символов</div>\n        </div>\n    </md-input-container>\n    <div layout="row">\n        <span flex></span>\n        <md-button ng-click="newFeedback.add()"\n                   ng-disabled="!(newFeedback.sender && newFeedback.text)"\n                   class="md-fab md-primary md-mini"\n                   aria-label="Sent">\n            <md-icon>send</md-icon>\n        </md-button>\n    </div>\n</form>\n')}]);
angular.module("pbApp.layout").run(["$templateCache",function(n){n.put("menu.directive.html",'<div>\n    <md-button class="md-icon-button" aria-label="Settings" ng-click="menu.openMenu()">\n        <md-icon>menu</md-icon>\n    </md-button>\n\n    <md-sidenav class="md-sidenav-left md-whiteframe-z2 pb-fixed"\n                md-component-id="left-menu">\n        <div layout="column">\n            <div layout="row" layout-padding>\n                <h3 class="pb-text-muted">Меню</h3>\n                <span flex></span>\n                <md-button class="md-icon-button" ng-click="menu.closeMenu()">\n                    <md-icon>keyboard_arrow_left</md-icon>\n                </md-button>\n            </div>\n            <md-divider></md-divider>\n            <md-content>\n                <md-list>\n                    <md-list-item ng-repeat="page in menu.pages"\n                                  ng-href="/#/{{ page.url }}">\n                        <md-icon class="pb-text-muted" style="color: grey;">{{ page.icon }}</md-icon>\n                        <p class="md-body-1 pb-text-muted">{{ page.name }}</p>\n                    </md-list-item>\n                </md-list>\n            </md-content>\n\n            <div class="pb-menu-copyright">\n                <p class="md-caption pb-text-muted">Алексей Маслаков, 2016</p>\n            </div>\n        </div>\n    </md-sidenav>\n</div>\n')}]);